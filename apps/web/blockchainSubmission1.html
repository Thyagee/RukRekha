
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blockchain Submission - RukRekha</title>
  <script type="module">
    import {
      BlockfrostProvider,
      Transaction,
      MeshWallet
    } from 'https://unpkg.com/@meshsdk/core?module';

    const blockfrost = new BlockfrostProvider('YOUR_BLOCKFROST_API_KEY'); // Replace with real key
    const wallet = new MeshWallet();

    async function hashData(data) {
      const encoder = new TextEncoder();
      const dataBuffer = encoder.encode(JSON.stringify(data));
      const hashBuffer = await crypto.subtle.digest('SHA-256', dataBuffer);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
      return hashHex;
    }

    async function submitToBlockchain() {
      const treeData = {
        treeType: document.getElementById('treeType').value,
        gps: document.getElementById('gps').value,
        plantingDate: document.getElementById('plantingDate').value,
        planterWallet: document.getElementById('walletAddress').value,
        planterName: document.getElementById('planterName').value
      };

      const hash = await hashData(treeData);
      document.getElementById('hashOutput').innerText = 'Hash: ' + hash;

      const tx = new Transaction({ initiator: wallet });

      tx.sendLovelace(
        'addr1qrecipientaddress...', // Replace with a real recipient
        '2000000' // Minimum ADA required for TX with metadata
      );

      tx.attachMetadata(674, {
        treeHash: hash,
        project: "RukRekha Tree Planting",
        timestamp: Date.now()
      });

      const unsignedTx = await tx.build();
      const signedTx = await wallet.signTx(unsignedTx);
      const txHash = await wallet.submitTx(signedTx);

      document.getElementById('txOutput').innerHTML = `Transaction Hash: <a href="https://cardanoscan.io/transaction/${txHash}" target="_blank">${txHash}</a>`;
    }
  </script>
</head>
<body style="font-family:sans-serif; background:#f0fff0; padding:20px;">
  <h2>ðŸŒ¿ Blockchain Submission - RukRekha</h2>

  <div>
    <label>Tree Type:</label><br>
    <input type="text" id="treeType"><br><br>

    <label>GPS Coordinates:</label><br>
    <input type="text" id="gps"><br><br>

    <label>Planting Date:</label><br>
    <input type="date" id="plantingDate"><br><br>

    <label>Planter Wallet Address:</label><br>
    <input type="text" id="walletAddress"><br><br>

    <label>Planter Name:</label><br>
    <input type="text" id="planterName"><br><br>

    <button onclick="submitToBlockchain()">Submit to Blockchain</button>
  </div>

  <div style="margin-top:20px;">
    <h3>Hash Output:</h3>
    <div id="hashOutput" style="background:white;padding:10px;border-radius:5px;"></div>
  </div>

  <div style="margin-top:20px;">
    <h3>Transaction Output:</h3>
    <div id="txOutput" style="background:white;padding:10px;border-radius:5px;"></div>
  </div>
</body>
</html>
